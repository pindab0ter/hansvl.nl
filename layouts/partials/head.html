<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />
  <title>
    {{ block "title" . }}
      {{ if .Title }}
        {{- .Title }} -
      {{ else }}
        {{ .Type | humanize }} -
      {{ end }}
      {{ .Site.Title -}}
    {{ end }}
  </title>
  {{- if .Description -}}
    <meta name="description" content="{{ .Description | safeHTML }}" />
  {{ else if .Site.Params.description }}
    <meta
      name="description"
      content="{{ .Site.Params.Description | safeHTML }}"
    />
  {{- end -}}
  {{- if .Params.Author -}}
    <meta name="author" content="{{ .Params.Author }}" />
  {{ end -}}
  {{ if hugo.IsProduction }}
    <meta name="robots" content="index,follow" />
  {{ else }}
    <meta name="robots" content="noindex,nofollow" />
  {{ end }}
  {{ hugo.Generator }}

  {{ template "_internal/opengraph.html" . }}
  {{ template "_internal/twitter_cards.html" . }}
  {{ template "partials/favicons.html" . }}
  {{ template "partials/site-schema.html" . }}

  <link
    rel="preload"
    href="/fonts/Inter-Light.ttf"
    as="font"
    type="font/ttf"
    crossorigin
  />
  <link
    rel="preload"
    href="/fonts/Inter-SemiBold.ttf"
    as="font"
    type="font/ttf"
    crossorigin
  />
  <link
    rel="preload"
    href="/fonts/JetBrainsMono-Regular.woff2"
    as="font"
    type="font/ttf"
    crossorigin
  />
  {{ range .AlternativeOutputFormats -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end -}}
  <link rel="canonical" href="{{ .Permalink }}" />

  {{ $styles := resources.Get "css/main.css" | postCSS }}
  {{- if .Site.IsServer }}
    <link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
  {{ else }}
    {{- $styles := $styles | minify | fingerprint | resources.PostProcess -}}
    <link
      rel="stylesheet"
      href="{{ $styles.Permalink }}"
      integrity="{{ $styles.Data.Integrity }}"
      crossorigin="anonymous"
    />
  {{ end -}}

  {{ $js := resources.Get "js/main.js" }}
  {{ if .Site.IsServer }}
    {{ $script := $js | js.Build | fingerprint }}
    <script data-precache src="{{ $script.Permalink }}" defer></script>
  {{ else }}
  {{ $script := $js | js.Build (dict "minify" true) | resources.Minify | fingerprint }}
    <script
      data-precache
      src="{{ $script.Permalink }}"
      integrity="{{ $script.Data.Integrity }}"
      crossorigin="anonymous"
      defer
    ></script>
  {{ end }}

  <script>
    const theme = localStorage.getItem("theme") ?? "system";
    const prefersDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const darkMode = theme === "dark" || (theme === "system" && prefersDarkMode);

    document.documentElement.classList.toggle("dark", darkMode);
  </script>

  {{ partial "analytics.html" . }}
</head>
